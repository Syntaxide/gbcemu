#include "memory.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

Memory::Memory() {
  size = 0x10000;
  memory = new uint8_t[size];
  memset(memory, 0, size);
  init();
}

Memory::~Memory() {
  delete[] memory;
}

void addLogo(uint8_t *start) {
  start[0] = 0x00;
  start[1] = 0x00;
  start[2] = 0x00;
  start[3] = 0x00;
  start[4] = 0x00;
  start[5] = 0x00;
  start[6] = 0x00;
  start[7] = 0x00;
  start[8] = 0x00;
  start[9] = 0x00;
  start[10] = 0x00;
  start[11] = 0x00;
  start[12] = 0x00;
  start[13] = 0x00;
  start[14] = 0x00;
  start[15] = 0x00;
  start[16] = 0xF0;
  start[17] = 0x00;
  start[18] = 0xF0;
  start[19] = 0x00;
  start[20] = 0xFC;
  start[21] = 0x00;
  start[22] = 0xFC;
  start[23] = 0x00;
  start[24] = 0xFC;
  start[25] = 0x00;
  start[26] = 0xFC;
  start[27] = 0x00;
  start[28] = 0xF3;
  start[29] = 0x00;
  start[30] = 0xF3;
  start[31] = 0x00;
  start[32] = 0x3C;
  start[33] = 0x00;
  start[34] = 0x3C;
  start[35] = 0x00;
  start[36] = 0x3C;
  start[37] = 0x00;
  start[38] = 0x3C;
  start[39] = 0x00;
  start[40] = 0x3C;
  start[41] = 0x00;
  start[42] = 0x3C;
  start[43] = 0x00;
  start[44] = 0x3C;
  start[45] = 0x00;
  start[46] = 0x3C;
  start[47] = 0x00;
  start[48] = 0xF0;
  start[49] = 0x00;
  start[50] = 0xF0;
  start[51] = 0x00;
  start[52] = 0xF0;
  start[53] = 0x00;
  start[54] = 0xF0;
  start[55] = 0x00;
  start[56] = 0x00;
  start[57] = 0x00;
  start[58] = 0x00;
  start[59] = 0x00;
  start[60] = 0xF3;
  start[61] = 0x00;
  start[62] = 0xF3;
  start[63] = 0x00;
  start[64] = 0x00;
  start[65] = 0x00;
  start[66] = 0x00;
  start[67] = 0x00;
  start[68] = 0x00;
  start[69] = 0x00;
  start[70] = 0x00;
  start[71] = 0x00;
  start[72] = 0x00;
  start[73] = 0x00;
  start[74] = 0x00;
  start[75] = 0x00;
  start[76] = 0xCF;
  start[77] = 0x00;
  start[78] = 0xCF;
  start[79] = 0x00;
  start[80] = 0x00;
  start[81] = 0x00;
  start[82] = 0x00;
  start[83] = 0x00;
  start[84] = 0x0F;
  start[85] = 0x00;
  start[86] = 0x0F;
  start[87] = 0x00;
  start[88] = 0x3F;
  start[89] = 0x00;
  start[90] = 0x3F;
  start[91] = 0x00;
  start[92] = 0x0F;
  start[93] = 0x00;
  start[94] = 0x0F;
  start[95] = 0x00;
  start[96] = 0x00;
  start[97] = 0x00;
  start[98] = 0x00;
  start[99] = 0x00;
  start[100] = 0x00;
  start[101] = 0x00;
  start[102] = 0x00;
  start[103] = 0x00;
  start[104] = 0xC0;
  start[105] = 0x00;
  start[106] = 0xC0;
  start[107] = 0x00;
  start[108] = 0x0F;
  start[109] = 0x00;
  start[110] = 0x0F;
  start[111] = 0x00;
  start[112] = 0x00;
  start[113] = 0x00;
  start[114] = 0x00;
  start[115] = 0x00;
  start[116] = 0x00;
  start[117] = 0x00;
  start[118] = 0x00;
  start[119] = 0x00;
  start[120] = 0x00;
  start[121] = 0x00;
  start[122] = 0x00;
  start[123] = 0x00;
  start[124] = 0xF0;
  start[125] = 0x00;
  start[126] = 0xF0;
  start[127] = 0x00;
  start[128] = 0x00;
  start[129] = 0x00;
  start[130] = 0x00;
  start[131] = 0x00;
  start[132] = 0x00;
  start[133] = 0x00;
  start[134] = 0x00;
  start[135] = 0x00;
  start[136] = 0x00;
  start[137] = 0x00;
  start[138] = 0x00;
  start[139] = 0x00;
  start[140] = 0xF3;
  start[141] = 0x00;
  start[142] = 0xF3;
  start[143] = 0x00;
  start[144] = 0x00;
  start[145] = 0x00;
  start[146] = 0x00;
  start[147] = 0x00;
  start[148] = 0x00;
  start[149] = 0x00;
  start[150] = 0x00;
  start[151] = 0x00;
  start[152] = 0x00;
  start[153] = 0x00;
  start[154] = 0x00;
  start[155] = 0x00;
  start[156] = 0xC0;
  start[157] = 0x00;
  start[158] = 0xC0;
  start[159] = 0x00;
  start[160] = 0x03;
  start[161] = 0x00;
  start[162] = 0x03;
  start[163] = 0x00;
  start[164] = 0x03;
  start[165] = 0x00;
  start[166] = 0x03;
  start[167] = 0x00;
  start[168] = 0x03;
  start[169] = 0x00;
  start[170] = 0x03;
  start[171] = 0x00;
  start[172] = 0xFF;
  start[173] = 0x00;
  start[174] = 0xFF;
  start[175] = 0x00;
  start[176] = 0xC0;
  start[177] = 0x00;
  start[178] = 0xC0;
  start[179] = 0x00;
  start[180] = 0xC0;
  start[181] = 0x00;
  start[182] = 0xC0;
  start[183] = 0x00;
  start[184] = 0xC0;
  start[185] = 0x00;
  start[186] = 0xC0;
  start[187] = 0x00;
  start[188] = 0xC3;
  start[189] = 0x00;
  start[190] = 0xC3;
  start[191] = 0x00;
  start[192] = 0x00;
  start[193] = 0x00;
  start[194] = 0x00;
  start[195] = 0x00;
  start[196] = 0x00;
  start[197] = 0x00;
  start[198] = 0x00;
  start[199] = 0x00;
  start[200] = 0x00;
  start[201] = 0x00;
  start[202] = 0x00;
  start[203] = 0x00;
  start[204] = 0xFC;
  start[205] = 0x00;
  start[206] = 0xFC;
  start[207] = 0x00;
  start[208] = 0xF3;
  start[209] = 0x00;
  start[210] = 0xF3;
  start[211] = 0x00;
  start[212] = 0xF0;
  start[213] = 0x00;
  start[214] = 0xF0;
  start[215] = 0x00;
  start[216] = 0xF0;
  start[217] = 0x00;
  start[218] = 0xF0;
  start[219] = 0x00;
  start[220] = 0xF0;
  start[221] = 0x00;
  start[222] = 0xF0;
  start[223] = 0x00;
  start[224] = 0x3C;
  start[225] = 0x00;
  start[226] = 0x3C;
  start[227] = 0x00;
  start[228] = 0xFC;
  start[229] = 0x00;
  start[230] = 0xFC;
  start[231] = 0x00;
  start[232] = 0xFC;
  start[233] = 0x00;
  start[234] = 0xFC;
  start[235] = 0x00;
  start[236] = 0x3C;
  start[237] = 0x00;
  start[238] = 0x3C;
  start[239] = 0x00;
  start[240] = 0xF3;
  start[241] = 0x00;
  start[242] = 0xF3;
  start[243] = 0x00;
  start[244] = 0xF3;
  start[245] = 0x00;
  start[246] = 0xF3;
  start[247] = 0x00;
  start[248] = 0xF3;
  start[249] = 0x00;
  start[250] = 0xF3;
  start[251] = 0x00;
  start[252] = 0xF3;
  start[253] = 0x00;
  start[254] = 0xF3;
  start[255] = 0x00;
  start[256] = 0xF3;
  start[257] = 0x00;
  start[258] = 0xF3;
  start[259] = 0x00;
  start[260] = 0xC3;
  start[261] = 0x00;
  start[262] = 0xC3;
  start[263] = 0x00;
  start[264] = 0xC3;
  start[265] = 0x00;
  start[266] = 0xC3;
  start[267] = 0x00;
  start[268] = 0xC3;
  start[269] = 0x00;
  start[270] = 0xC3;
  start[271] = 0x00;
  start[272] = 0xCF;
  start[273] = 0x00;
  start[274] = 0xCF;
  start[275] = 0x00;
  start[276] = 0xCF;
  start[277] = 0x00;
  start[278] = 0xCF;
  start[279] = 0x00;
  start[280] = 0xCF;
  start[281] = 0x00;
  start[282] = 0xCF;
  start[283] = 0x00;
  start[284] = 0xCF;
  start[285] = 0x00;
  start[286] = 0xCF;
  start[287] = 0x00;
  start[288] = 0x3C;
  start[289] = 0x00;
  start[290] = 0x3C;
  start[291] = 0x00;
  start[292] = 0x3F;
  start[293] = 0x00;
  start[294] = 0x3F;
  start[295] = 0x00;
  start[296] = 0x3C;
  start[297] = 0x00;
  start[298] = 0x3C;
  start[299] = 0x00;
  start[300] = 0x0F;
  start[301] = 0x00;
  start[302] = 0x0F;
  start[303] = 0x00;
  start[304] = 0x3C;
  start[305] = 0x00;
  start[306] = 0x3C;
  start[307] = 0x00;
  start[308] = 0xFC;
  start[309] = 0x00;
  start[310] = 0xFC;
  start[311] = 0x00;
  start[312] = 0x00;
  start[313] = 0x00;
  start[314] = 0x00;
  start[315] = 0x00;
  start[316] = 0xFC;
  start[317] = 0x00;
  start[318] = 0xFC;
  start[319] = 0x00;
  start[320] = 0xFC;
  start[321] = 0x00;
  start[322] = 0xFC;
  start[323] = 0x00;
  start[324] = 0xF0;
  start[325] = 0x00;
  start[326] = 0xF0;
  start[327] = 0x00;
  start[328] = 0xF0;
  start[329] = 0x00;
  start[330] = 0xF0;
  start[331] = 0x00;
  start[332] = 0xF0;
  start[333] = 0x00;
  start[334] = 0xF0;
  start[335] = 0x00;
  start[336] = 0xF3;
  start[337] = 0x00;
  start[338] = 0xF3;
  start[339] = 0x00;
  start[340] = 0xF3;
  start[341] = 0x00;
  start[342] = 0xF3;
  start[343] = 0x00;
  start[344] = 0xF3;
  start[345] = 0x00;
  start[346] = 0xF3;
  start[347] = 0x00;
  start[348] = 0xF0;
  start[349] = 0x00;
  start[350] = 0xF0;
  start[351] = 0x00;
  start[352] = 0xC3;
  start[353] = 0x00;
  start[354] = 0xC3;
  start[355] = 0x00;
  start[356] = 0xC3;
  start[357] = 0x00;
  start[358] = 0xC3;
  start[359] = 0x00;
  start[360] = 0xC3;
  start[361] = 0x00;
  start[362] = 0xC3;
  start[363] = 0x00;
  start[364] = 0xFF;
  start[365] = 0x00;
  start[366] = 0xFF;
  start[367] = 0x00;
  start[368] = 0xCF;
  start[369] = 0x00;
  start[370] = 0xCF;
  start[371] = 0x00;
  start[372] = 0xCF;
  start[373] = 0x00;
  start[374] = 0xCF;
  start[375] = 0x00;
  start[376] = 0xCF;
  start[377] = 0x00;
  start[378] = 0xCF;
  start[379] = 0x00;
  start[380] = 0xC3;
  start[381] = 0x00;
  start[382] = 0xC3;
  start[383] = 0x00;
  start[384] = 0x0F;
  start[385] = 0x00;
  start[386] = 0x0F;
  start[387] = 0x00;
  start[388] = 0x0F;
  start[389] = 0x00;
  start[390] = 0x0F;
  start[391] = 0x00;
  start[392] = 0x0F;
  start[393] = 0x00;
  start[394] = 0x0F;
  start[395] = 0x00;
  start[396] = 0xFC;
  start[397] = 0x00;
  start[398] = 0xFC;
  start[399] = 0x00;
  start[400] = 0x3C;
  start[401] = 0x00;
  start[402] = 0x42;
  start[403] = 0x00;
  start[404] = 0xB9;
  start[405] = 0x00;
  start[406] = 0xA5;
  start[407] = 0x00;
  start[408] = 0xB9;
  start[409] = 0x00;
  start[410] = 0xA5;
  start[411] = 0x00;
  start[412] = 0x42;
  start[413] = 0x00;
  start[414] = 0x3C;
  start[415] = 0x00;
  start[416] = 0x00;
  start[417] = 0x00;
  start[418] = 0x00;
  start[419] = 0x00;
  start[420] = 0x00;
  start[421] = 0x00;
  start[422] = 0x00;
  start[423] = 0x00;
  start[424] = 0x00;
  start[425] = 0x00;
  start[426] = 0x00;
  start[427] = 0x00;
  start[428] = 0x00;
  start[429] = 0x00;
  start[430] = 0x00;
  start[431] = 0x00;
  start[432] = 0x00;
  start[433] = 0x00;
  start[434] = 0x00;
  start[435] = 0x00;
  start[436] = 0x00;
  start[437] = 0x00;
  start[438] = 0x00;
  start[439] = 0x00;
  start[440] = 0x00;
  start[441] = 0x00;
  start[442] = 0x00;
  start[443] = 0x00;
  start[444] = 0x00;
  start[445] = 0x00;
  start[446] = 0x00;
  start[447] = 0x00;
  start[448] = 0x00;
  start[449] = 0x00;
  start[450] = 0x00;
  start[451] = 0x00;
  start[452] = 0x00;
  start[453] = 0x00;
  start[454] = 0x00;
  start[455] = 0x00;
  start[456] = 0x00;
  start[457] = 0x00;
  start[458] = 0x00;
  start[459] = 0x00;
  start[460] = 0x00;
  start[461] = 0x00;
  start[462] = 0x00;
  start[463] = 0x00;
  start[464] = 0x00;
  start[465] = 0x00;
  start[466] = 0x00;
  start[467] = 0x00;
  start[468] = 0x00;
  start[469] = 0x00;
  start[470] = 0x00;
  start[471] = 0x00;
  start[472] = 0x00;
  start[473] = 0x00;
  start[474] = 0x00;
  start[475] = 0x00;
  start[476] = 0x00;
  start[477] = 0x00;
  start[478] = 0x00;
  start[479] = 0x00;
  start[480] = 0x00;
  start[481] = 0x00;
  start[482] = 0x00;
  start[483] = 0x00;
  start[484] = 0x00;
  start[485] = 0x00;
  start[486] = 0x00;
  start[487] = 0x00;
  start[488] = 0x00;
  start[489] = 0x00;
  start[490] = 0x00;
  start[491] = 0x00;
  start[492] = 0x00;
  start[493] = 0x00;
  start[494] = 0x00;
  start[495] = 0x00;
  start[496] = 0x00;
  start[497] = 0x00;
  start[498] = 0x00;
  start[499] = 0x00;
  start[500] = 0x00;
  start[501] = 0x00;
  start[502] = 0x00;
  start[503] = 0x00;
  start[504] = 0x00;
  start[505] = 0x00;
  start[506] = 0x00;
  start[507] = 0x00;
  start[508] = 0x00;
  start[509] = 0x00;
  start[510] = 0x00;
  start[511] = 0x00;
}
void Memory::init() {
  write8(0xff10, 0x80);
  write8(0xff11, 0xbf);
  write8(0xff12, 0xf3);
  write8(0xff14, 0xbf);
  write8(0xff16, 0x3f);
  write8(0xFF17,0x00);
  write8(0xFF19,0xBF);
  write8(0xFF1A,0x7F);
  write8(0xFF1B,0xFF);
  write8(0xFF1C,0x9F);
  write8(0xFF1E,0xBF);
  write8(0xFF20,0xFF);
  write8(0xFF21,0x00);
  write8(0xFF22,0x00);
  write8(0xFF23,0xBF);
  write8(0xFF24,0x77);
  write8(0xFF25,0xF3);
  write8(0xFF26,0xF1);
  write8(0xFF40,0x91);
  write8(0xFF42,0x00);
  write8(0xFF43,0x00);
  write8(0xFF45,0x00);
  write8(0xFF47,0xFC);
  write8(0xFF48,0xFF);
  write8(0xFF49,0xFF);
  write8(0xFF4A,0x00);
  write8(0xFF4B,0x00);
  write8(0xFFFF,0x00);
  write8(LCDC, 0x83);
  write8(IE, 0);
  addLogo(memory+0x8000);
}

uint8_t Memory::read8(int address) const {
  if(address >=0 && address < size) {
    return memory[address];
  }
  puts("attempted read to memory out of bounds");
  exit(-1);
}
uint16_t Memory::read16(int address) {
  puts("not implemented");
  exit(-1);
}

void Memory::write8(int address, uint8_t value) {
  //printf("write8(%x, %x)\n", address, value);
  if(address >=0 && address < size) {
    memory[address] = value;
  } else {
    puts("attempted to write to out of bounds memory");
    exit(-1);
  }
}
void Memory::write16(int address, uint16_t value) {
  puts("not implemented");
  exit(-1);
}
